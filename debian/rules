#!/usr/bin/make -f

include /usr/share/pkg-kde-tools/makefiles/1/variables.mk

DEB_DESTDIR = $(CURDIR)/debian/tmp

%:
	dh --with quilt $@

override_dh_auto_configure:
	mkdir builddir
	cd builddir && cmake .. \
		-DCMAKE_INSTALL_PREFIX=/usr \
		-DCMAKE_C_FLAGS="$(CFLAGS)" \
		-DCMAKE_LD_FLAGS="-Wl,-z,defs" \
		-DCMAKE_CXX_FLAGS="$(CXXFLAGS)" \
		-DCMAKE_SKIP_RPATH=ON \
		-DCMAKE_VERBOSE_MAKEFILE=ON \
		$(DEB_CMAKE_KDE4_FLAGS)


override_dh_auto_build:
	$(MAKE) -C builddir


override_dh_auto_clean:
	rm -rf builddir

override_dh_auto_install:
	$(MAKE) -C builddir DESTDIR=$(DEB_DESTDIR) install

	# Install pixmap
	install -D -p -m0644 debian/kile.xpm $(DEB_DESTDIR)/usr/share/pixmaps/kile.xpm

	# Fix lintian warning: script-not-executable
	chmod +x $(DEB_DESTDIR)/usr/share/kde4/apps/kile/test/runTests.sh
	chmod +x $(DEB_DESTDIR)/usr/share/kde4/apps/kconf_update/kile*_upd.pl

	# Syntax files bibtex.xml and latex.xml are provided by kdelibs5-data package.
	find $(DEB_DESTDIR) -type f -name bibtex.xml | xargs rm -f
	find $(DEB_DESTDIR) -type f -name latex.xml | xargs rm -f

	# Fix lintian warning: package-contains-readme-for-other-platform-or-distro
	find $(DEB_DESTDIR) -type f -name README.MacOSX | xargs rm -f
